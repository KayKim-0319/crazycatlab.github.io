// Terms of Service translations
const termsTranslations = {
    en: {
        // Navigation (reuse from main)
        'nav.about': 'About',
        'nav.services': 'Services',
        'nav.portfolio': 'Portfolio',
        'nav.stack': 'Tech Stack',
        'nav.contact': 'Contact',
        
        // Terms of Service
        'terms.title': 'Terms of Service',
        'terms.updated': 'Last updated: ',
        
        'terms.intro.title': 'Introduction',
        'terms.intro.content': 'Welcome to CrazyCat Lab. These Terms of Service ("Terms") govern your use of our website and mobile applications ("Services") operated by CrazyCat Lab ("we," "our," or "us").',
        
        'terms.acceptance.title': 'Acceptance of Terms',
        'terms.acceptance.content': 'By accessing and using our Services, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.',
        
        'terms.services.title': 'Description of Services',
        'terms.services.content': 'CrazyCat Lab provides mobile application development services and maintains a website showcasing our portfolio and services. Our Services include:',
        'terms.services.item1': 'Mobile application development (iOS and Android)',
        'terms.services.item2': 'Cross-platform development using Flutter',
        'terms.services.item3': 'Native development using Kotlin and Swift',
        'terms.services.item4': 'Consultation and technical support',
        
        'terms.use.title': 'Acceptable Use',
        'terms.use.content': 'You agree to use our Services only for lawful purposes and in accordance with these Terms. You agree not to:',
        'terms.use.item1': 'Use the Services for any unlawful purpose or to solicit others to perform unlawful acts',
        'terms.use.item2': 'Violate any international, federal, provincial, or state regulations, rules, laws, or local ordinances',
        'terms.use.item3': 'Infringe upon or violate our intellectual property rights or the intellectual property rights of others',
        'terms.use.item4': 'Harass, abuse, insult, harm, defame, slander, disparage, intimidate, or discriminate',
        'terms.use.item5': 'Submit false or misleading information',
        'terms.use.item6': 'Upload or transmit viruses or any other type of malicious code',
        
        'terms.intellectual.title': 'Intellectual Property Rights',
        'terms.intellectual.content': 'The Services and their original content, features, and functionality are and will remain the exclusive property of CrazyCat Lab and its licensors. The Services are protected by copyright, trademark, and other laws.',
        
        'terms.user.title': 'User Content',
        'terms.user.content': 'Our Services may allow you to post, link, store, share and otherwise make available certain information, text, graphics, videos, or other material ("Content"). You are responsible for the Content that you post to the Services, including its legality, reliability, and appropriateness.',
        
        'terms.privacy.title': 'Privacy Policy',
        'terms.privacy.content': 'Your privacy is important to us. Please review our Privacy Policy, which also governs your use of the Services, to understand our practices.',
        
        'terms.termination.title': 'Termination',
        'terms.termination.content': 'We may terminate or suspend your access immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.',
        
        'terms.disclaimer.title': 'Disclaimer',
        'terms.disclaimer.content': 'The information on this website is provided on an "as is" basis. To the fullest extent permitted by law, this Company:',
        'terms.disclaimer.item1': 'Excludes all representations and warranties relating to this website and its contents',
        'terms.disclaimer.item2': 'Excludes all liability for damages arising out of or in connection with your use of this website',
        
        'terms.limitation.title': 'Limitation of Liability',
        'terms.limitation.content': 'In no event shall CrazyCat Lab, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your use of the Services.',
        
        'terms.governing.title': 'Governing Law',
        'terms.governing.content': 'These Terms shall be interpreted and governed by the laws of the Republic of Korea, without regard to its conflict of law provisions.',
        
        'terms.changes.title': 'Changes to Terms',
        'terms.changes.content': 'We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material, we will try to provide at least 30 days notice prior to any new terms taking effect.',
        
        'terms.contact.title': 'Contact Information',
        'terms.contact.content': 'If you have any questions about these Terms of Service, please contact us at:',
        'terms.contact.company': 'Company:',
        'terms.contact.location': 'Location:',
        'terms.contact.location.value': 'Korea (Republic of Korea)',
        
        // Footer
        'footer.rights': 'All rights reserved.',
        'footer.privacy': 'Privacy Policy',
        'footer.terms': 'Terms of Service'
    },
    ko: {
        // Navigation (reuse from main)
        'nav.about': '소개',
        'nav.services': '서비스',
        'nav.portfolio': '포트폴리오',
        'nav.stack': '기술 스택',
        'nav.contact': '연락처',
        
        // Terms of Service
        'terms.title': '이용약관',
        'terms.updated': '최종 업데이트: ',
        
        'terms.intro.title': '소개',
        'terms.intro.content': '크레이지캣 랩(CrazyCat Lab)에 오신 것을 환영합니다. 본 이용약관("약관")은 크레이지캣 랩(CrazyCat Lab)("당사", "저희" 또는 "우리")가 운영하는 웹사이트 및 모바일 애플리케이션("서비스") 사용을 규정합니다.',
        
        'terms.acceptance.title': '약관 동의',
        'terms.acceptance.content': '당사 서비스에 액세스하고 사용함으로써 귀하는 본 계약의 조건과 규정에 구속되는 것에 동의합니다. 위 사항에 동의하지 않으시면 본 서비스를 사용하지 마십시오.',
        
        'terms.services.title': '서비스 설명',
        'terms.services.content': '크레이지캣 랩(CrazyCat Lab)은 모바일 애플리케이션 개발 서비스를 제공하고 포트폴리오와 서비스를 보여주는 웹사이트를 운영합니다. 당사 서비스에는 다음이 포함됩니다:',
        'terms.services.item1': '모바일 애플리케이션 개발 (iOS 및 Android)',
        'terms.services.item2': 'Flutter를 사용한 크로스 플랫폼 개발',
        'terms.services.item3': 'Kotlin 및 Swift를 사용한 네이티브 개발',
        'terms.services.item4': '컨설팅 및 기술 지원',
        
        'terms.use.title': '허용 가능한 사용',
        'terms.use.content': '귀하는 합법적인 목적으로만 그리고 본 약관에 따라 당사 서비스를 사용하는 데 동의합니다. 귀하는 다음을 하지 않기로 동의합니다:',
        'terms.use.item1': '불법적인 목적으로 서비스를 사용하거나 다른 사람에게 불법 행위를 수행하도록 권유',
        'terms.use.item2': '국제, 연방, 지방 또는 주 규정, 규칙, 법률 또는 지역 조례 위반',
        'terms.use.item3': '당사의 지적 재산권 또는 타인의 지적 재산권 침해 또는 위반',
        'terms.use.item4': '괴롭힘, 남용, 모욕, 해를 끼침, 명예 훼손, 중상, 비방, 협박 또는 차별',
        'terms.use.item5': '허위 또는 오해의 소지가 있는 정보 제출',
        'terms.use.item6': '바이러스 또는 기타 유형의 악성 코드 업로드 또는 전송',
        
        'terms.intellectual.title': '지적 재산권',
        'terms.intellectual.content': '서비스와 그 원본 콘텐츠, 기능 및 기능성은 크레이지캣 랩(CrazyCat Lab)과 라이센스의 독점적 재산이며 앞으로도 그럴 것입니다. 서비스는 저작권, 상표권 및 기타 법률로 보호됩니다.',
        
        'terms.user.title': '사용자 콘텐츠',
        'terms.user.content': '당사 서비스를 통해 특정 정보, 텍스트, 그래픽, 비디오 또는 기타 자료("콘텐츠")를 게시, 링크, 저장, 공유 및 기타 방법으로 제공할 수 있습니다. 귀하는 서비스에 게시하는 콘텐츠의 합법성, 신뢰성 및 적절성에 대해 책임집니다.',
        
        'terms.privacy.title': '개인정보 처리방침',
        'terms.privacy.content': '귀하의 개인정보는 당사에게 중요합니다. 당사의 관행을 이해하기 위해 서비스 사용을 규정하는 개인정보 처리방침을 검토해 주십시오.',
        
        'terms.termination.title': '종료',
        'terms.termination.content': '당사는 약관 위반을 포함하여 어떤 이유로든 사전 통지나 책임 없이 즉시 귀하의 액세스를 종료하거나 중단할 수 있습니다.',
        
        'terms.disclaimer.title': '면책 조항',
        'terms.disclaimer.content': '본 웹사이트의 정보는 "있는 그대로" 제공됩니다. 법률이 허용하는 최대 범위 내에서 본 회사는:',
        'terms.disclaimer.item1': '본 웹사이트 및 그 내용과 관련된 모든 진술 및 보증을 배제합니다',
        'terms.disclaimer.item2': '본 웹사이트 사용과 관련하여 발생하는 손해에 대한 모든 책임을 배제합니다',
        
        'terms.limitation.title': '책임 제한',
        'terms.limitation.content': '어떠한 경우에도 크레이지캣 랩(CrazyCat Lab), 그 이사, 직원, 파트너, 대리인, 공급업체 또는 계열사는 서비스 사용으로 인한 이익, 데이터, 사용, 영업권 또는 기타 무형 손실의 손실을 포함하되 이에 국한되지 않는 간접적, 부수적, 특별, 결과적 또는 징벌적 손해에 대해 책임지지 않습니다.',
        
        'terms.governing.title': '준거법',
        'terms.governing.content': '본 약관은 법률 충돌 조항에 관계없이 대한민국 법률에 의해 해석되고 규율됩니다.',
        
        'terms.changes.title': '약관 변경',
        'terms.changes.content': '당사는 언제든지 단독 재량으로 본 약관을 수정하거나 교체할 권리를 보유합니다. 개정이 중대한 경우 새로운 약관이 발효되기 최소 30일 전에 통지하도록 노력하겠습니다.',
        
        'terms.contact.title': '연락처 정보',
        'terms.contact.content': '본 이용약관에 대한 질문이 있으시면 다음으로 연락해 주세요:',
        'terms.contact.company': '회사:',
        'terms.contact.location': '위치:',
        'terms.contact.location.value': '대한민국',
        
        // Footer
        'footer.rights': '모든 권리 보유.',
        'footer.privacy': '개인정보 처리방침',
        'footer.terms': '이용약관'
    }
};

// Use terms translations directly
const translations = termsTranslations;

// Current language state
let currentLanguage = localStorage.getItem('language') || 'en';

// Initialize i18n
function initI18n() {
    // 페이지 로드 시 localStorage에서 언어 다시 확인
    const storedLanguage = localStorage.getItem('language');
    if (storedLanguage && storedLanguage !== currentLanguage) {
        currentLanguage = storedLanguage;
    }
    
    updateLanguageButtons();
    applyTranslations();
    document.documentElement.lang = currentLanguage;
    
    // Set current year
    if (document.getElementById('currentYear')) {
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    }
}

// Switch language functions
function switchToEnglish() {
    currentLanguage = 'en';
    localStorage.setItem('language', 'en');
    updateLanguageButtons();
    applyTranslations();
    document.documentElement.lang = 'en';
}

function switchToKorean() {
    currentLanguage = 'ko';
    localStorage.setItem('language', 'ko');
    updateLanguageButtons();
    applyTranslations();
    document.documentElement.lang = 'ko';
}

// Update language button states
function updateLanguageButtons() {
    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach(btn => {
        btn.classList.remove('active');
        if ((btn.textContent === 'EN' && currentLanguage === 'en') ||
            (btn.textContent === '한국어' && currentLanguage === 'ko')) {
            btn.classList.add('active');
        }
    });
}

// Apply translations to all elements with data-i18n attribute
function applyTranslations() {
    const elements = document.querySelectorAll('[data-i18n]');
    
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = getTranslation(key);
        
        if (translation && translation !== key) {
            // 특별한 경우 처리 (날짜가 포함된 텍스트)
            if (key === 'privacy.updated' && element.querySelector('#privacy-date')) {
                element.innerHTML = translation + '<span id="privacy-date">December 4, 2025</span>';
            } else if (key === 'terms.updated' && element.querySelector('#terms-date')) {
                element.innerHTML = translation + '<span id="terms-date">December 4, 2025</span>';
            } else {
                element.textContent = translation;
            }
        }
    });
}

// Get translation for a key
function getTranslation(key) {
    // Check if translations object exists
    if (!translations || !translations[currentLanguage]) {
        return key;
    }
    
    // Direct key lookup first (for simple keys like 'nav.about')
    if (translations[currentLanguage][key]) {
        return translations[currentLanguage][key];
    }
    
    // Navigate through nested object using dot notation
    const keys = key.split('.');
    let translation = translations[currentLanguage];
    
    for (let i = 0; i < keys.length; i++) {
        const k = keys[i];
        
        if (translation && typeof translation === 'object' && translation.hasOwnProperty(k)) {
            translation = translation[k];
        } else {
            // Fallback to English
            translation = translations.en;
            if (translation) {
                for (let j = 0; j < keys.length; j++) {
                    const fallbackKey = keys[j];
                    if (translation && typeof translation === 'object' && translation.hasOwnProperty(fallbackKey)) {
                        translation = translation[fallbackKey];
                    } else {
                        return key;
                    }
                }
            } else {
                return key;
            }
            break;
        }
    }
    
    return typeof translation === 'string' ? translation : key;
}

// Make functions globally available
window.switchToEnglish = switchToEnglish;
window.switchToKorean = switchToKorean;
window.updateLanguageButtons = updateLanguageButtons;
window.applyTranslations = applyTranslations;

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', initI18n);

// 추가 초기화 - 페이지가 완전히 로드된 후에도 실행
window.addEventListener('load', function() {
    // 함수가 덮어쓰여졌는지 다시 확인
    if (!window.switchToEnglish) {
        window.switchToEnglish = switchToEnglish;
        window.switchToKorean = switchToKorean;
        window.updateLanguageButtons = updateLanguageButtons;
        window.applyTranslations = applyTranslations;
    }
    
    // 약간의 지연 후 다시 번역 적용
    setTimeout(() => {
        const storedLanguage = localStorage.getItem('language');
        if (storedLanguage) {
            currentLanguage = storedLanguage;
            updateLanguageButtons();
            applyTranslations();
        }
    }, 100);
});